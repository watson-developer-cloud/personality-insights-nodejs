!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.PersonalitySunburstChart=t()}}(function(){return function t(e,n,r){function a(d,o){if(!n[d]){if(!e[d]){var s="function"==typeof require&&require;if(!o&&s)return s(d,!0);if(i)return i(d,!0);throw new Error("Cannot find module '"+d+"'")}var l=n[d]={exports:{}};e[d][0].call(l.exports,function(t){var n=e[d][1][t];return a(n?n:t)},l,l.exports,t,e,n,r)}return n[d].exports}for(var i="function"==typeof require&&require,d=0;d<r.length;d++)a(r[d]);return a}({1:[function(t,e,n){var r=t("./personality-chart-renderer"),a={d3:"D3js",$:"JQuery"};Object.keys(a).forEach(function(t){if("undefined"==typeof window[t])throw new Error(a[t]+" is not present. Personality Sunburst Chart can't render without it.")}),e.exports=function(){"use strict";var t=function(t,e){function n(t,e){console.debug("showVizualization()");var n=s.containerId;$("#"+n).empty();var a=d3.select("#"+n).append("svg:svg"),i={d3vis:a,data:t,loadingDiv:"dummy",switchState:function(){console.debug("[switchState]")},_layout:function(){console.debug("[_layout]")},showTooltip:function(){console.debug("[showTooltip]")},id:"SystemUWidget",COLOR_PALLETTE:["#1b6ba2","#488436","#d52829","#F53B0C","#972a6b","#8c564b","#dddddd"],expandAll:function(){this.vis.selectAll("g").each(function(){var t=d3.select(this);t.datum().parent&&t.datum().parent.parent&&t.datum().parent.parent.parent&&t.attr("visibility","visible")})},collapseAll:function(){this.vis.selectAll("g").each(function(){var t=d3.select(this);null!==t.datum().parent&&null!==t.datum().parent.parent&&null!==t.datum().parent.parent.parent&&t.attr("visibility","hidden")})},addPersonImage:function(t){if(this.vis&&t){var e=this.vis.append("defs"),n=this.dimW,r=this.dimH,a=Math.min(n,r)/16.58,i=2.46*a,d="user_icon_"+this.id;e.append("pattern").attr("id",d).attr("height",1).attr("width",1).attr("patternUnits","objectBoundingBox").append("image").attr("width",i).attr("height",i).attr("x",a-i/2).attr("y",a-i/2).attr("xlink:href",t).attr("opacity",1).on("dblclick.zoom",null),this.vis.append("circle").attr("r",a).attr("stroke-width",0).attr("fill","url(#"+d+")")}}};i.dimH=s.height,i.dimW=s.width,i.d3vis.attr("width",s.visualizationWidth).attr("height",s.visualizationHeight),i.d3vis.attr("viewBox","0 -30 "+i.dimW+", "+i.dimH),r.render.call(i),i.expandAll.call(i),e&&i.addPersonImage.call(i,e)}e=e||{};var a=e.width||"100%",i=e.height||"100%",d=45*(1/e.scale||1)*16.58,o=45*(1/e.scale||1)*16.58,s={containerId:t,container:$("#"+t),d3Container:d3.select("#"+t),width:d,dimW:d,height:o,dimH:o,visualizationWidth:a||"100%",visualizationHeight:i||"100%",d3vis:void 0,touchDiv:void 0,data:void 0,id:"SystemUWidget",COLOR_PALLETTE:["#1b6ba2","#488436","#d52829","#F53B0C","#972a6b","#8c564b","#dddddd"],loadingDiv:"dummy"};return s.clean=function(){s.container.empty()},s.show=n,s};return t}()},{"./personality-chart-renderer":2}],2:[function(t,e,n){"use strict";function r(t){return t.radius}function a(t){return t.startAngle}function i(t){return t.endAngle}function d(){d3.svg.singleArc=s}function o(){d(),c.call(this)}var s=function(){function t(){var t=e.apply(this,arguments),r=n.apply(this,arguments)+o,a=d.apply(this,arguments)+o,i=(r>a&&(i=r,r=a,a=i),a-r),s=i<Math.PI?"0":"1",l=Math.cos(r),c=Math.sin(r),u=Math.cos(a),h=Math.sin(a);return"M"+t*l+","+t*c+"A"+t+","+t+" 0 "+s+",1 "+t*u+","+t*h}var e=r,n=a,d=i,o=-Math.PI/2;return t.radius=function(n){return arguments.length?(e=d3.functor(n),t):e},t.startAngle=function(e){return arguments.length?(n=d3.functor(e),t):n},t.endAngle=function(e){return arguments.length?(d=d3.functor(e),t):d},t.centroid=function(){var t=e.apply(this,arguments),r=(n.apply(this,arguments)+d.apply(this,arguments))/2+o;return[Math.cos(r)*t,Math.sin(r)*t]},t},l={isLocatedBottom:function(t){var e=t.x>Math.PI/2&&t.x+t.dx<5;return e},arc:function(t,e,n){var r=Math.cos(t),a=Math.sin(t),i=Math.cos(e),d=Math.sin(e);return"M"+n*r+","+n*a+"A"+n+","+n+" 0 0 , 0 "+n*i+","+n*d}},c=function(){function t(t){t.x0=t.x,t.dx0=t.dx,t.hasOwnProperty("size")||t.hasOwnProperty("children")?t.size0=t.size:t.size0=1,0===t.depth||1===t.depth?t.expand=1:t.expand=0}function e(t){null!==t.expand&&t.depth>1&&(0===t.expand?(t.children&&d3.select(this).attr("opacity",1),b.filter(function(e){return e.parent?e.parent.id===t.id:void 0}).attr("visibility","visible"),t.expand=1):(t.children&&d3.select(this).attr("opacity",1),n(t)))}function n(t){b.filter(function(e){return e.parent?e.parent.id===t.id:void 0}).attr("visibility","hidden").attr("opacity",1).each(function(t){t.children&&n(t)}),t.expand=0}function r(t){function e(t){t.each(function(e){t=d3.select(this),t.selectAll("path").remove(),t.selectAll("text").remove();var n=e.depth>0?u/(3*e.depth):u,r=e.percentage,a=1;null===r&&(r=1),null===e.percentage_lbl&&(e.percentage_lbl="");var i,o=e.name,s=null===e.percentage||isNaN(e.percentage)?"":" ("+(100*e.percentage).toFixed(0)+"%)";1===e.depth&&(i=e.name),e.depth>1&&("sbh_dom"===e.id||"sbh_parent"===e.id?i=e.name:"values"===e.category?i=e.name+("NaN"===(100*r).toFixed(0)||isNaN(r)?"":" ("+(100*r).toFixed(0)+"%)"):(r>=1?(r=.99,console.debug("Percentage is over 1!"+e.name)):-1>=r&&(r=-.99,console.debug("Percentage is below -1!"+e.name)),i=e.name+("NaN"===(100*r).toFixed(0)||isNaN(r)?"":" ("+(100*r).toFixed(0)+"%)"),Math.round(100*parseFloat(r))/100===0&&(i=e.name))),""===e.name&&(r=0,i=""),null!==e.perc_neu&&(e.percentage+e.perc_neu)*e.dx<e.dx-u/(3*e.depth)&&(a=e.percentage+e.perc_neu,d3.svg.arc().startAngle(function(t){return t.x+Math.abs(a)*t.dx}).endAngle(function(t){return t.x+t.dx-u/(3*t.depth)}).innerRadius(function(t){return h+t.y}).outerRadius(function(t){return t.y+t.dy}),n=0);var p,f,y,g,x=Math.abs(r)*e.dx-n>0?Math.abs(r)*e.dx-n:0,v=d3.svg.arc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+x}).innerRadius(function(t){return h+t.y}).outerRadius(function(t){return t.y+t.dy}),m=d3.svg.arc().startAngle(function(t){return t.x+x}).endAngle(function(t){return t.x+Math.abs(a)*t.dx-n}).innerRadius(function(t){return h+t.y}).outerRadius(function(t){return t.y+t.dy});1===e.depth&&l.isLocatedBottom(e)?(y=e.y+e.dy-(e.y+e.dy-h-e.y)/6,g=e.y+e.dy-(e.y+e.dy-h-e.y)/8):(y=h+e.y+5*(e.y+e.dy-h-e.y)/12,g=e.y+e.dy-(e.y+e.dy-h-e.y)/7);var b=l.isLocatedBottom(e);b?(p=l.arc(e.x+e.dx-n-Math.PI/2,e.x-Math.PI/2,y),f=l.arc(e.x+e.dx-n-Math.PI/2,e.x-Math.PI/2,g)):(p=d3.svg.singleArc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+t.dx-n}).radius(function(t){return 1===t.depth?t.y+t.dy-(t.y+t.dy-h-t.y)/3:h+t.y+3*(t.y+t.dy-h-t.y)/5}),f=d3.svg.singleArc().startAngle(function(t){return t.x}).endAngle(function(t){return t.x+t.dx-n}).radius(function(t){return 1===t.depth?t.y+t.dy-(t.y+t.dy-h-t.y)/3:h+t.y+(t.y+t.dy-h-t.y)/5})),e.coloridx=0,1===e.depth||0===e.depth?e.coloridx=e.id:e.coloridx=e.parent.coloridx;var _;"personality"===e.coloridx&&(_=c.COLOR_PALLETTE[0]),"needs"===e.coloridx&&(_=c.COLOR_PALLETTE[1]),"values"===e.coloridx&&(_=c.COLOR_PALLETTE[2]),"sr"===e.coloridx&&(_=c.COLOR_PALLETTE[3]),"sbh"===e.coloridx&&(_=c.COLOR_PALLETTE[4]),"blank"===e.coloridx&&(_=c.COLOR_PALLETTE[6]),_=e.depth<2?_:d3.rgb(_).brighter(Math.pow(1.1,1.5*e.depth));var M=d3.rgb(_).darker(.8);if(e.children||"srasrt"===e.id||"srclo"===e.id||"srdom"===e.id)t.append("path").attr("class","arc1").attr("d",v).style("stroke",M).style("fill",_),t.append("path").attr("class","arc2").attr("d",m).style("stroke",M).style("fill",_).style("fill-opacity",.15),t.append("path").attr("class","arc_for_label").attr("id",function(t){return d.id+"_"+t.id+".arc_for_label"}).attr("d",p).style("stroke-opacity",0).style("fill-opacity",0),t.append("text").attr("class","sector_label").attr("visibility",function(t){return 1===t.depth?"visible":null}).attr("class","sector_nonleaf_text").append("textPath").attr("class","sector_label_path").attr("position-in-sector",e.depth<=1?"center":b?"inner":"outer").attr("font-size",function(t){return 30/Math.sqrt(t.depth+1)}).attr("xlink:href",function(t){return"#"+d.id+"_"+t.id+".arc_for_label"}).text(o),e.depth>1&&(t.append("path").attr("class","arc_for_label_number").attr("id",function(t){return d.id+"_"+t.id+".arc_for_label_number"}).attr("d",f).style("stroke-opacity",0).style("fill-opacity",0),t.append("text").attr("class","sector_label_number ").attr("visibility",function(t){return 1===t.depth?"visible":null}).attr("class","sector_nonleaf_text").append("textPath").attr("class","sector_label_number_path").attr("position-in-sector",b?"outer":"inner").attr("font-size",function(t){return 10}).attr("xlink:href",function(t){return"#"+d.id+"_"+t.id+".arc_for_label_number"}).text(s));else{i=e.name,r=e.percentage;var A=10/(e.depth-2);e.parent&&(e.parent.parent?(("needs"===e.parent.parent.id||"values"===e.parent.parent.id)&&(A=1),"sbh"===e.parent.parent.id&&(A=0,r>1&&(r=Math.random(),e.percentage=r)),e.parent.parent.parent&&"personality"===e.parent.parent.parent.id&&(A=1)):console.debug(e.name+": Parent is null!"));var w,P=h+e.y;w=h+e.y+A*Math.abs(r)*e.dy,"Low"===e.percentage_lbl&&(w=h+e.y+.2*A*e.dy);var L=d3.svg.arc().startAngle(e.x).endAngle(e.x+e.dx).innerRadius(P).outerRadius(w);t.append("path").attr("class","_bar").attr("d",L).style("stroke","#EEE").style("fill",function(t){return d3.rgb(_).darker(.5)});var E=0,O="start",T=0;i=e.name,e.x>Math.PI?(E=180*e.x/Math.PI+90,O="end",T=20*-e.dx*Math.PI):(E=180*e.x/Math.PI-90,O="start",T=5+20*e.dx*Math.PI);var z=13,I=10;7.5+15*Math.PI*e.dx>z&&(I=z),i+="NaN"===(100*r).toFixed(0)||isNaN(r)?"":" ("+(100*r).toFixed(0)+"%)",t.append("text").attr("dy",T).attr("class","sector_leaf_text").attr("font-size",I).attr("text-anchor",O).attr("transform","translate("+(w+5)*Math.sin(e.x)+","+-(w+5)*Math.cos(e.x)+") rotate("+E+")").text(i)}})}return e}function a(){i(".sector_label_path"),i(".sector_label_number_path")}function i(t){var e=16;d.d3vis.selectAll(t).each(function(t){var n=d3.select(this),r=n.node(),a=n.text();if(a&&a.length>0){var i=d3.select(this).attr("position-in-sector"),d="center"===i?.5:"outer"===i?2/3:1/3,o=(t.y+t.dy*d)*t.dx,s=r.getComputedTextLength(),l=d3.select(this).attr("font-size"),c=l*o/s;c>e/(.4*t.depth+.6)&&(c=e/(.4*t.depth+.6)),d3.select(this).attr("font-size",c),d3.select(this).attr("startOffset",(o-r.getComputedTextLength())/2)}})}if(!this.data)return void this.showError();if(this.vis)return void console.error("Cannot render: Already rendered (this.vis)");var d=this,o=!1,s=this.data?this.data.tree?this.data.tree:this.data:null;if(s&&s.children&&s.children.length){var c=this;if(!this.loadingDiv)return void alert("Widget is not fully initialized, cannot render BarsWidget");this.switchState(1),this._layout();var u=o?1e-4:.08*Math.PI,h=5,p=this.dimW,f=this.dimH,y=Math.min(p,f)/3.2,g=r(y),x=this.d3vis.append("g").attr("transform","translate("+p/2+","+f/2+")").append("g");this.vis=x;var v=d3.layout.partition().sort(null).size([2*Math.PI,y]).value(function(t){return t.hasOwnProperty("size")||t.hasOwnProperty("children")?t.size:1}),m=s,b=x.data([m]).selectAll("g").data(v.nodes).enter().append("g").attr("class","sector").attr("visibility",function(t){return 2===t.depth||t.forceVisible?"visible":"hidden"}).call(g).each(t).on("click",e).on("mouseover",function(t){d.showTooltip(t,this)}).on("mouseout",function(){d.showTooltip()});a()}};e.exports={render:o}},{}]},{},[1])(1)});
